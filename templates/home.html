{% extends "base.html" %}

{% block content %}
<style>
    :root {
        --robot-blue: #0066ff;
        --industrial-gray: #1a1c1e;
        --steel-border: #2d3136;
        --text-main: #e1e1e1;
        --text-muted: #62676b;
        --bg-deep: #050505;
    }

    body {
        background-color: var(--bg-deep) !important;
        color: var(--text-main);
        font-family: 'JetBrains Mono', 'Segoe UI', monospace;
    }

    /* PANEL SUPERIOR */
    .otto-panel {
        background: var(--industrial-gray);
        border: 1px solid var(--steel-border);
        margin: 15px;
        padding: 15px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }

    .panel-info { display: flex; align-items: center; gap: 12px; }
    .status-indicator { width: 8px; height: 8px; background: var(--robot-blue); box-shadow: 0 0 8px var(--robot-blue); }
    .panel-title { font-weight: 700; font-size: 11px; letter-spacing: 1.5px; margin: 0; }

    /* BUSCADOR */
    .search-container { padding: 0 15px; margin-bottom: 20px; }
    .search-box { background: #000; border: 1px solid var(--steel-border); display: flex; border-radius: 2px; overflow: hidden; }
    .search-input { background: transparent; border: none; color: white; padding: 12px 15px; width: 100%; font-size: 12px; outline: none; }
    .search-btn { background: var(--robot-blue); color: white; border: none; padding: 0 20px; font-weight: bold; font-size: 11px; cursor: pointer; }

    /* CATEGORÍAS */
    .cat-btn {
        background: #0f1113; border: 1px solid #2d3136; color: #888; padding: 10px 18px;
        text-decoration: none; font-size: 11px; font-weight: 700; text-transform: uppercase;
        border-radius: 4px; display: flex; align-items: center; transition: 0.2s;
    }
    .cat-btn:hover, .cat-btn.active { border-color: var(--robot-blue); color: #fff; background: rgba(0, 102, 255, 0.1); }

    /* GRID Y CARDS */
    .market-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 15px 20px; }
    .product-card { background: var(--industrial-gray); border: 1px solid var(--steel-border); padding: 8px; position: relative; }
    .img-container { width: 100%; height: 120px; background: #000; margin-bottom: 8px; position: relative; overflow: hidden; }
    .img-container img { width: 100%; height: 100%; object-fit: cover; }
    .unit-label { position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.8); border-left: 2px solid var(--robot-blue); color: white; font-size: 8px; padding: 2px 6px; }
    .product-title { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 2px; }
    .price-display { font-size: 1.2rem; font-weight: 800; color: #fff; margin-bottom: 8px; }
    .action-button { text-decoration: none; color: var(--robot-blue); border: 1px solid var(--robot-blue); text-align: center; padding: 6px; font-size: 9px; font-weight: bold; display: block; }

    /* ESTILOS DEL SISTEMA DE CARGA (SKELETON) */
    .skeleton-card { border-color: #1a1c1e !important; }
    .sk-block { 
        background: linear-gradient(90deg, #111 25%, #1a1c1e 50%, #111 75%);
        background-size: 200% 100%; animation: shimmer 1.5s infinite linear;
    }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
</style>
<div class="otto-panel-premium">
    <div class="border-glow"></div>
    
    <div class="panel-info">
        <div class="status-indicator blink-alive"></div>
        <h2 class="panel-title">OTTO_MARKET // GLOBAL_RADAR</h2>
    </div>
    <span class="units-counter">UNITS_LOADED: {{ anuncios|length }}</span>
</div>

<style>
    .otto-panel-premium {
        position: relative;
        background: rgba(5, 5, 5, 0.9);
        padding: 15px;
        border: 1px solid rgba(0, 243, 255, 0.2);
        overflow: hidden;
        display: flex;
        justify-content: space-between;
        align-items: center;
        /* Corte futurista */
        clip-path: polygon(0 0, 95% 0, 100% 25%, 100% 100%, 5% 100%, 0 75%);
    }

    /* EL PUNTO PARPADEANTE (STATUS) */
    .status-indicator.blink-alive {
        width: 8px;
        height: 8px;
        background: #00f3ff;
        box-shadow: 0 0 10px #00f3ff;
        border-radius: 2px;
        margin-right: 10px;
        animation: pulse-life 1s infinite;
    }

    @keyframes pulse-life {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.3; transform: scale(1.2); }
        100% { opacity: 1; transform: scale(1); }
    }

    /* LUZ QUE RECORRE EL PERÍMETRO */
    .border-glow {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none;
    }

    .border-glow::before {
        content: "";
        position: absolute;
        width: 60px; height: 2px;
        background: #00f3ff;
        box-shadow: 0 0 15px #00f3ff;
        animation: track-border 4s linear infinite;
    }

    @keyframes track-border {
        0% { top: 0; left: -60px; }
        25% { top: 0; left: 100%; }
        50% { top: 100%; left: 100%; transform: rotate(90deg); }
        75% { top: 100%; left: -60px; }
        100% { top: 0; left: -60px; }
    }

    .panel-info { display: flex; align-items: center; }
    .panel-title {
        color: #00f3ff;
        font-family: 'Orbitron', sans-serif;
        font-size: 0.8rem;
        letter-spacing: 2px;
        margin: 0;
        text-shadow: 0 0 5px rgba(0, 243, 255, 0.5);
    }

    .units-counter {
        color: #555;
        font-family: 'monospace';
        font-size: 9px;
        text-transform: uppercase;
    }
</style>


<div class="search-container">
    <form action="{% url 'home' %}" method="GET">
        <div class="search-box">
            <input type="text" name="q" class="search-input" placeholder="ESCANEANDO_DATA..." value="{{ request.GET.q }}">
            <button type="submit" class="search-btn" onclick="showOttoNotification('CONEXIÓN_ESTABLECIDA', 'success')">
    BUSCAR
</button>

        </div>
    </form>
</div>

<div class="category-scanner mb-4" style="padding: 0 15px;">
    <div class="d-flex justify-content-center flex-wrap gap-2">
        <a href="{% url 'home' %}" class="cat-btn active">TODO</a>
        <a href="?q=Carro" class="cat-btn">VEHÍCULOS</a>
        <a href="?q=Celular" class="cat-btn">TECNOLOGÍA</a>
        <a href="?q=Hogar" class="cat-btn">HOGAR</a>
        <a href="?q=Servicio" class="cat-btn">SERVICIOS</a>
    </div>
</div>

<div id="loading-skeleton" class="market-container">
    {% for i in "1234" %}
    <div class="product-card skeleton-card">
        <div class="sk-block" style="height: 120px; margin-bottom: 8px;"></div>
        <div class="sk-block" style="height: 10px; width: 60%; margin-bottom: 8px;"></div>
        <div class="sk-block" style="height: 20px; width: 40%; margin-bottom: 10px;"></div>
        <div class="sk-block" style="height: 30px; width: 100%;"></div>
    </div>
    {% endfor %}
</div>

<div id="real-content" class="market-container" style="display: none;">
    {% for anuncio in anuncios %}
    <div class="product-card">
        <div class="img-container">
            <div class="unit-label">{{ anuncio.tipo_negocio }}</div>
            {% if anuncio.foto %}
                <img src="{{ anuncio.foto.url }}" alt="Data">
            {% else %}
                <div style="height: 100%; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #333;">NO_DATA</div>
            {% endif %}
        </div>
        <div class="product-title">{{ anuncio.marca }} {{ anuncio.modelo }}</div>
        <div class="price-display">${{ anuncio.precio }}</div>
<a href="{% url 'detalle' anuncio.id %}" 
   class="action-button" 
   onclick="showOttoNotification('ACCEDIENDO_A_DATOS_RESERVADOS...', 'info')">
    ABRIR_EXPEDIENTE
</a>

    </div>
    {% empty %}
        <div style="grid-column: span 2; text-align: center; padding: 100px 0;">
        <i class="bi bi-cpu text-muted" style="font-size: 30px;"></i>
        <p style="font-size: 10px; color: var(--text-muted); margin-top: 10px;">QUERY_NOT_FOUND: NO SE DETECTARON SEÑALES.</p>
    </div>
    {% endfor %}
</div>

<script>
    window.addEventListener('load', function() {
        // Apaga los cuadros grises
        document.getElementById('loading-skeleton').style.display = 'none';
        // Enciende los anuncios reales
        document.getElementById('real-content').style.display = 'grid';
    });
</script>

{% endblock %}
